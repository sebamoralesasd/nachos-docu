<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NachOS: code/filesys/file_system.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NachOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_050edd66366d13764f98250ef6db77f6.html">code</a></li><li class="navelem"><a class="el" href="dir_8e72e263aa613966cfdc557bf0a05642.html">filesys</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">file_system.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="file__system_8hh_source.html">file_system.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="directory_8hh_source.html">directory.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="file__header_8hh_source.html">file_header.hh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="bitmap_8hh_source.html">lib/bitmap.hh</a>&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:afc1a4dbb366072caf753cab0de91c15c"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#afc1a4dbb366072caf753cab0de91c15c">AddToShadowBitmap</a> (unsigned sector, <a class="el" href="classBitmap.html">Bitmap</a> *map)</td></tr>
<tr class="separator:afc1a4dbb366072caf753cab0de91c15c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98a51de0b98fafebf864fdf8060d1e9e"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#a98a51de0b98fafebf864fdf8060d1e9e">CheckForError</a> (bool value, const char *message)</td></tr>
<tr class="separator:a98a51de0b98fafebf864fdf8060d1e9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60bf78bee6bff5c6545f329d07fc1121"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#a60bf78bee6bff5c6545f329d07fc1121">CheckSector</a> (unsigned sector, <a class="el" href="classBitmap.html">Bitmap</a> *shadowMap)</td></tr>
<tr class="separator:a60bf78bee6bff5c6545f329d07fc1121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae307bedb07729e298e18b726ad8f267a"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#ae307bedb07729e298e18b726ad8f267a">CheckFileHeader</a> (const <a class="el" href="structRawFileHeader.html">RawFileHeader</a> *rh, unsigned num, <a class="el" href="classBitmap.html">Bitmap</a> *shadowMap)</td></tr>
<tr class="separator:ae307bedb07729e298e18b726ad8f267a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55255c5faba86294c06c3964dd568c35"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#a55255c5faba86294c06c3964dd568c35">CheckBitmaps</a> (const <a class="el" href="classBitmap.html">Bitmap</a> *freeMap, const <a class="el" href="classBitmap.html">Bitmap</a> *shadowMap)</td></tr>
<tr class="separator:a55255c5faba86294c06c3964dd568c35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27269162f89f27d1c2cee32c5cc021d3"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#a27269162f89f27d1c2cee32c5cc021d3">CheckDirectory</a> (const <a class="el" href="structRawDirectory.html">RawDirectory</a> *<a class="el" href="instr_8h.html#abc8417c51ad8d314b0298e4295609df7">rd</a>, <a class="el" href="classBitmap.html">Bitmap</a> *shadowMap)</td></tr>
<tr class="separator:a27269162f89f27d1c2cee32c5cc021d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1d57cd2239174c30fe53d259cccb8c32"><td class="memItemLeft" align="right" valign="top">static const unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#a1d57cd2239174c30fe53d259cccb8c32">FREE_MAP_SECTOR</a> = 0</td></tr>
<tr class="separator:a1d57cd2239174c30fe53d259cccb8c32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2761cce2bfdd914633dbf65ebe8b427c"><td class="memItemLeft" align="right" valign="top">static const unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file__system_8cc.html#a2761cce2bfdd914633dbf65ebe8b427c">DIRECTORY_SECTOR</a> = 1</td></tr>
<tr class="separator:a2761cce2bfdd914633dbf65ebe8b427c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="afc1a4dbb366072caf753cab0de91c15c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc1a4dbb366072caf753cab0de91c15c">&#9670;&nbsp;</a></span>AddToShadowBitmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool AddToShadowBitmap </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>map</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a55255c5faba86294c06c3964dd568c35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55255c5faba86294c06c3964dd568c35">&#9670;&nbsp;</a></span>CheckBitmaps()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool CheckBitmaps </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>freeMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>shadowMap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a27269162f89f27d1c2cee32c5cc021d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27269162f89f27d1c2cee32c5cc021d3">&#9670;&nbsp;</a></span>CheckDirectory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool CheckDirectory </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structRawDirectory.html">RawDirectory</a> *&#160;</td>
          <td class="paramname"><em>rd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>shadowMap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ae307bedb07729e298e18b726ad8f267a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae307bedb07729e298e18b726ad8f267a">&#9670;&nbsp;</a></span>CheckFileHeader()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool CheckFileHeader </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structRawFileHeader.html">RawFileHeader</a> *&#160;</td>
          <td class="paramname"><em>rh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>shadowMap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a98a51de0b98fafebf864fdf8060d1e9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98a51de0b98fafebf864fdf8060d1e9e">&#9670;&nbsp;</a></span>CheckForError()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool CheckForError </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a60bf78bee6bff5c6545f329d07fc1121"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60bf78bee6bff5c6545f329d07fc1121">&#9670;&nbsp;</a></span>CheckSector()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool CheckSector </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>shadowMap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a2761cce2bfdd914633dbf65ebe8b427c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2761cce2bfdd914633dbf65ebe8b427c">&#9670;&nbsp;</a></span>DIRECTORY_SECTOR</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned DIRECTORY_SECTOR = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a1d57cd2239174c30fe53d259cccb8c32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d57cd2239174c30fe53d259cccb8c32">&#9670;&nbsp;</a></span>FREE_MAP_SECTOR</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned FREE_MAP_SECTOR = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Routines to manage the overall operation of the file system. Implements routines to map from textual file names to files.</p>
<p>Each file in the file system has:</p><ul>
<li>a file header, stored in a sector on disk (the size of the file header data structure is arranged to be precisely the size of 1 disk sector);</li>
<li>a number of data blocks;</li>
<li>an entry in the file system directory.</li>
</ul>
<p>The file system consists of several data structures:</p><ul>
<li>A bitmap of free disk sectors (cf. <code>bitmap.h</code>).</li>
<li>A directory of file names and file headers.</li>
</ul>
<p>Both the bitmap and the directory are represented as normal files. Their file headers are located in specific sectors (sector 0 and sector 1), so that the file system can find them on bootup.</p>
<p>The file system assumes that the bitmap and directory files are kept “open” continuously while Nachos is running.</p>
<p>For those operations (such as <code>Create</code>, <code>Remove</code>) that modify the directory and/or bitmap, if the operation succeeds, the changes are written immediately back to disk (the two files are kept open during all this time). If the operation fails, and we have modified part of the directory and/or bitmap, we simply discard the changed version, without writing it back to disk.</p>
<p>Our implementation at this point has the following restrictions:</p>
<ul>
<li>there is no synchronization for concurrent accesses;</li>
<li>files have a fixed size, set when the file is created;</li>
<li>files cannot be bigger than about 3KB in size;</li>
<li>there is no hierarchical directory structure, and only a limited number of files can be added to the system;</li>
<li>there is no attempt to make the system robust to failures (if Nachos exits in the middle of an operation that modifies the file system, it may corrupt the disk).</li>
</ul>
<p>Copyright (c) 1992-1993 The Regents of the University of California. 2016-2021 Docentes de la Universidad Nacional de Rosario. All rights reserved. See <code><a class="el" href="copyright_8h.html">copyright.h</a></code> for copyright notice and limitation of liability and disclaimer of warranty provisions. Sectors containing the file headers for the bitmap of free sectors, and the directory of files. These file headers are placed in well-known sectors, so that they can be located on boot-up. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
