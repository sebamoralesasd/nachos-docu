<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NachOS: MMU Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NachOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="classMMU-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">MMU Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="mmu_8hh_source.html">mmu.hh</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3cc26755183540beee71619d7549b189"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a3cc26755183540beee71619d7549b189">MMU</a> ()</td></tr>
<tr class="separator:a3cc26755183540beee71619d7549b189"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6037c8609281c7d11b74bebee6287ad5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a6037c8609281c7d11b74bebee6287ad5">~MMU</a> ()</td></tr>
<tr class="separator:a6037c8609281c7d11b74bebee6287ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecfc1342e12c1104fa03ee483a7df256"><td class="memItemLeft" align="right" valign="top"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#aecfc1342e12c1104fa03ee483a7df256">ReadMem</a> (unsigned addr, unsigned size, int *value)</td></tr>
<tr class="separator:aecfc1342e12c1104fa03ee483a7df256"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0810805e0bd634893195547812c61d9f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a0810805e0bd634893195547812c61d9f">WriteMem</a> (unsigned addr, unsigned size, int value)</td></tr>
<tr class="separator:a0810805e0bd634893195547812c61d9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5548dc80940aa0305d0aac31930c510d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a5548dc80940aa0305d0aac31930c510d">PrintTLB</a> () const</td></tr>
<tr class="separator:a5548dc80940aa0305d0aac31930c510d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a9bd26003376fb89ce3ba281ca889b146"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a9bd26003376fb89ce3ba281ca889b146">mainMemory</a></td></tr>
<tr class="separator:a9bd26003376fb89ce3ba281ca889b146"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a786744a523f389c999497084ab86abd0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTranslationEntry.html">TranslationEntry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a786744a523f389c999497084ab86abd0">tlb</a></td></tr>
<tr class="separator:a786744a523f389c999497084ab86abd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7e3f46f25119fa4995bc70187345e81"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTranslationEntry.html">TranslationEntry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#ae7e3f46f25119fa4995bc70187345e81">pageTable</a></td></tr>
<tr class="separator:ae7e3f46f25119fa4995bc70187345e81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a57acd0278157d718732d3191e8162c"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a3a57acd0278157d718732d3191e8162c">pageTableSize</a></td></tr>
<tr class="separator:a3a57acd0278157d718732d3191e8162c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a7be592fe6d443ce73a2804fd385aeaa4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#a7be592fe6d443ce73a2804fd385aeaa4">RetrievePageEntry</a> (unsigned vpn, <a class="el" href="classTranslationEntry.html">TranslationEntry</a> **entry) const</td></tr>
<tr class="memdesc:a7be592fe6d443ce73a2804fd385aeaa4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve a page entry either from a page table or the TLB.  <a href="classMMU.html#a7be592fe6d443ce73a2804fd385aeaa4">More...</a><br /></td></tr>
<tr class="separator:a7be592fe6d443ce73a2804fd385aeaa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accaeec5f0c756ba459204457d5dc35b7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMMU.html#accaeec5f0c756ba459204457d5dc35b7">Translate</a> (unsigned virtAddr, unsigned *physAddr, unsigned size, bool writing)</td></tr>
<tr class="separator:accaeec5f0c756ba459204457d5dc35b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class simulates an <a class="el" href="classMMU.html">MMU</a> (memory management unit) that can use either page tables or a TLB. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3cc26755183540beee71619d7549b189"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cc26755183540beee71619d7549b189">&#9670;&nbsp;</a></span>MMU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MMU::MMU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Routines to translate virtual addresses to physical addresses.</p>
<p>Software sets up a table of legal translations. We look up in the table on every memory reference to find the true physical memory location.</p>
<p>Two types of translation are supported here.</p>
<p>Linear page table &ndash; the virtual page # is used as an index into the table, to find the physical page #.</p>
<p>Translation lookaside buffer &ndash; associative lookup in the table to find an entry with the same virtual page #. If found, this entry is used for the translation. If not, it traps to software with an exception.</p>
<p>In practice, the TLB is much smaller than the amount of physical memory (16 entries is common on a machine that has 1000's of pages). Thus, there must also be a backup translation scheme (such as page tables), but the hardware does not need to know anything at all about that.</p>
<p>Note that the contents of the TLB are specific to an address space. If the address space changes, so does the contents of the TLB!</p>
<p>DO NOT CHANGE &ndash; part of the machine emulation</p>
<p>Copyright (c) 1992-1993 The Regents of the University of California. 2016-2021 Docentes de la Universidad Nacional de Rosario. All rights reserved. See <code><a class="el" href="copyright_8h.html">copyright.h</a></code> for copyright notice and limitation of liability and disclaimer of warranty provisions. </p>

</div>
</div>
<a id="a6037c8609281c7d11b74bebee6287ad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6037c8609281c7d11b74bebee6287ad5">&#9670;&nbsp;</a></span>~MMU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MMU::~MMU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a5548dc80940aa0305d0aac31930c510d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5548dc80940aa0305d0aac31930c510d">&#9670;&nbsp;</a></span>PrintTLB()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MMU::PrintTLB </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aecfc1342e12c1104fa03ee483a7df256"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecfc1342e12c1104fa03ee483a7df256">&#9670;&nbsp;</a></span>ReadMem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a> MMU::ReadMem </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read or write 1, 2, or 4 bytes of virtual memory (at <code>addr</code>). Return false if a correct translation could not be found.</p>
<p>Read <code>size</code> (1, 2, or 4) bytes of virtual memory at <code>addr</code> into the location pointed to by <code>value</code>.</p>
<p>Returns false if the translation step from virtual to physical memory failed.</p>
<ul>
<li><code>addr</code> is the virtual address to read from.</li>
<li><code>size</code> is the number of bytes to read (1, 2, or 4).</li>
<li><code>value</code> is the place to write the result. </li>
</ul>

</div>
</div>
<a id="a7be592fe6d443ce73a2804fd385aeaa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7be592fe6d443ce73a2804fd385aeaa4">&#9670;&nbsp;</a></span>RetrievePageEntry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a> MMU::RetrievePageEntry </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>vpn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classTranslationEntry.html">TranslationEntry</a> **&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve a page entry either from a page table or the TLB. </p>

</div>
</div>
<a id="accaeec5f0c756ba459204457d5dc35b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accaeec5f0c756ba459204457d5dc35b7">&#9670;&nbsp;</a></span>Translate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a> MMU::Translate </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>virtAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>physAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>writing</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Translate an address, and check for alignment.</p>
<p>Set the use and dirty bits in the translation entry appropriately, and return an exception code if the translation could not be completed.</p>
<p>Translate a virtual address into a physical address, using either a page table or a TLB.</p>
<p>Check for alignment and all sorts of other errors, and if everything is ok, set the use/dirty bits in the translation table entry, and store the translated physical address in "physAddr". If there was an error, returns the type of the exception.</p>
<ul>
<li><code>virtAddr" is the virtual address to translate.
*&lt;/tt&gt;physAddr" is the place to store the physical address.</code></li>
<li><code>`size" is the amount of memory being read or written.</code></li>
<li><code><code>writing</code> &ndash; if true, check the “read-only” bit in the TLB. </code></li>
</ul>

</div>
</div>
<a id="a0810805e0bd634893195547812c61d9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0810805e0bd634893195547812c61d9f">&#9670;&nbsp;</a></span>WriteMem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="exception__type_8hh.html#a0e0f0f1661d7aeb71ed9698bff6c6383">ExceptionType</a> MMU::WriteMem </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write <code>size</code> (1, 2, or 4) bytes of the contents of <code>value</code> into virtual memory at location <code>addr</code>.</p>
<p>Returns false if the translation step from virtual to physical memory failed.</p>
<ul>
<li><code>addr</code> is the virtual address to write to.</li>
<li><code>size</code> is the number of bytes to be written (1, 2, or 4).</li>
<li><code>value</code> is the data to be written. </li>
</ul>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a9bd26003376fb89ce3ba281ca889b146"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bd26003376fb89ce3ba281ca889b146">&#9670;&nbsp;</a></span>mainMemory</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* MMU::mainMemory</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Data structures &ndash; all of these are accessible to Nachos kernel code. “Public” for convenience.</p>
<p>Note that <em>all</em> communication between the user program and the kernel are in terms of these data structures, along with the already declared methods. Physical memory to store user program, code and data, while executing. </p>

</div>
</div>
<a id="ae7e3f46f25119fa4995bc70187345e81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7e3f46f25119fa4995bc70187345e81">&#9670;&nbsp;</a></span>pageTable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTranslationEntry.html">TranslationEntry</a>* MMU::pageTable</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3a57acd0278157d718732d3191e8162c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a57acd0278157d718732d3191e8162c">&#9670;&nbsp;</a></span>pageTableSize</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned MMU::pageTableSize</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a786744a523f389c999497084ab86abd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a786744a523f389c999497084ab86abd0">&#9670;&nbsp;</a></span>tlb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTranslationEntry.html">TranslationEntry</a>* MMU::tlb</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>NOTE: the hardware translation of virtual addresses in the user program to physical addresses (relative to the beginning of <code>mainMemory</code>) can be controlled by one of:</p><ul>
<li>a traditional linear page table;</li>
<li>a software-loaded translation lookaside buffer (tlb) &ndash; a cache of mappings of virtual page #'s to physical page #'s.</li>
</ul>
<p>If <code>tlb</code> is null, the linear page table is used. If <code>tlb</code> is non-null, the Nachos kernel is responsible for managing the contents of the TLB. But the kernel can use any data structure it wants (eg, segmented paging) for handling TLB cache misses.</p>
<p>For simplicity, both the page table pointer and the TLB pointer are public. However, while there can be multiple page tables (one per address space, stored in memory), there is only one TLB (implemented in hardware). Thus the TLB pointer should be considered as <em>read-only</em>, although the contents of the TLB are free to be modified by the kernel software. This pointer should be considered “read-only” to Nachos kernel code. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>code/machine/<a class="el" href="mmu_8hh_source.html">mmu.hh</a></li>
<li>code/machine/<a class="el" href="mmu_8cc.html">mmu.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
