<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NachOS: FileHeader Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NachOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classFileHeader-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">FileHeader Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="file__header_8hh_source.html">file_header.hh</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae0eec87626931be046202fc9bb60dc03"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#ae0eec87626931be046202fc9bb60dc03">Allocate</a> (<a class="el" href="classBitmap.html">Bitmap</a> *bitMap, unsigned fileSize)</td></tr>
<tr class="separator:ae0eec87626931be046202fc9bb60dc03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba5f6b90b6d3e51b293e0bad250699fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#aba5f6b90b6d3e51b293e0bad250699fc">Deallocate</a> (<a class="el" href="classBitmap.html">Bitmap</a> *bitMap)</td></tr>
<tr class="memdesc:aba5f6b90b6d3e51b293e0bad250699fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-allocate this file's data blocks.  <a href="classFileHeader.html#aba5f6b90b6d3e51b293e0bad250699fc">More...</a><br /></td></tr>
<tr class="separator:aba5f6b90b6d3e51b293e0bad250699fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f204ada637bf3cbd4c7438b7db30fa5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#a5f204ada637bf3cbd4c7438b7db30fa5">FetchFrom</a> (unsigned sectorNumber)</td></tr>
<tr class="memdesc:a5f204ada637bf3cbd4c7438b7db30fa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize file header from disk.  <a href="classFileHeader.html#a5f204ada637bf3cbd4c7438b7db30fa5">More...</a><br /></td></tr>
<tr class="separator:a5f204ada637bf3cbd4c7438b7db30fa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d08a36ec22587dd7219596bed30beb5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#a0d08a36ec22587dd7219596bed30beb5">WriteBack</a> (unsigned sectorNumber)</td></tr>
<tr class="memdesc:a0d08a36ec22587dd7219596bed30beb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write modifications to file header back to disk.  <a href="classFileHeader.html#a0d08a36ec22587dd7219596bed30beb5">More...</a><br /></td></tr>
<tr class="separator:a0d08a36ec22587dd7219596bed30beb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4029e71591a45f88bee884bff4ad4e14"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#a4029e71591a45f88bee884bff4ad4e14">ByteToSector</a> (unsigned offset)</td></tr>
<tr class="separator:a4029e71591a45f88bee884bff4ad4e14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58fa10ef7ffd228b461ce7519e0e60c7"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#a58fa10ef7ffd228b461ce7519e0e60c7">FileLength</a> () const</td></tr>
<tr class="memdesc:a58fa10ef7ffd228b461ce7519e0e60c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the length of the file in bytes.  <a href="classFileHeader.html#a58fa10ef7ffd228b461ce7519e0e60c7">More...</a><br /></td></tr>
<tr class="separator:a58fa10ef7ffd228b461ce7519e0e60c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b7b8f2d9b0ddc2a78b29b0aac89dd49"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#a8b7b8f2d9b0ddc2a78b29b0aac89dd49">Print</a> (const char *title)</td></tr>
<tr class="memdesc:a8b7b8f2d9b0ddc2a78b29b0aac89dd49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the contents of the file.  <a href="classFileHeader.html#a8b7b8f2d9b0ddc2a78b29b0aac89dd49">More...</a><br /></td></tr>
<tr class="separator:a8b7b8f2d9b0ddc2a78b29b0aac89dd49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1da76f52a592a1debb38ae0c05d62cf9"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structRawFileHeader.html">RawFileHeader</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#a1da76f52a592a1debb38ae0c05d62cf9">GetRaw</a> () const</td></tr>
<tr class="separator:a1da76f52a592a1debb38ae0c05d62cf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ad0a0cd13bb4f917c85d45a446a2e61df"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRawFileHeader.html">RawFileHeader</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileHeader.html#ad0a0cd13bb4f917c85d45a446a2e61df">raw</a></td></tr>
<tr class="separator:ad0a0cd13bb4f917c85d45a446a2e61df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Data structures for managing a disk file header.</p>
<p>A file header describes where on disk to find the data in a file, along with other information about the file (for instance, its length, owner, etc.)</p>
<p>Copyright (c) 1992-1993 The Regents of the University of California. 2016-2021 Docentes de la Universidad Nacional de Rosario. All rights reserved. See <code><a class="el" href="copyright_8h.html">copyright.h</a></code> for copyright notice and limitation of liability and disclaimer of warranty provisions. The following class defines the Nachos "file header" (in UNIX terms, the “i-node”), describing where on disk to find all of the data in the file. The file header is organized as a simple table of pointers to data blocks.</p>
<p>The file header data structure can be stored in memory or on disk. When it is on disk, it is stored in a single sector &ndash; this means that we assume the size of this data structure to be the same as one disk sector. Without indirect addressing, this limits the maximum file length to just under 4K bytes.</p>
<p>There is no constructor; rather the file header can be initialized by allocating blocks for the file (if it is a new file), or by reading it from disk. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ae0eec87626931be046202fc9bb60dc03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0eec87626931be046202fc9bb60dc03">&#9670;&nbsp;</a></span>Allocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool FileHeader::Allocate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>freeMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>fileSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize a file header, including allocating space on disk for the file data.</p>
<p>Routines for managing the disk file header (in UNIX, this would be called the i-node).</p>
<p>The file header is used to locate where on disk the file's data is stored. We implement this as a fixed size table of pointers &ndash; each entry in the table points to the disk sector containing that portion of the file data (in other words, there are no indirect or doubly indirect blocks). The table size is chosen so that the file header will be just big enough to fit in one disk sector,</p>
<p>Unlike in a real system, we do not keep track of file permissions, ownership, last modification date, etc., in the file header.</p>
<p>A file header can be initialized in two ways:</p>
<ul>
<li>for a new file, by modifying the in-memory data structure to point to the newly allocated data blocks;</li>
<li>for a file already on disk, by reading the file header from disk.</li>
</ul>
<p>Copyright (c) 1992-1993 The Regents of the University of California. 2016-2021 Docentes de la Universidad Nacional de Rosario. All rights reserved. See <code><a class="el" href="copyright_8h.html">copyright.h</a></code> for copyright notice and limitation of liability and disclaimer of warranty provisions. Initialize a fresh file header for a newly created file. Allocate data blocks for the file out of the map of free disk blocks. Return false if there are not enough free blocks to accomodate the new file.</p>
<ul>
<li><code>freeMap</code> is the bit map of free disk sectors.</li>
<li><code>fileSize</code> is the bit map of free disk sectors. </li>
</ul>

</div>
</div>
<a id="a4029e71591a45f88bee884bff4ad4e14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4029e71591a45f88bee884bff4ad4e14">&#9670;&nbsp;</a></span>ByteToSector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned FileHeader::ByteToSector </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>offset</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Convert a byte offset into the file to the disk sector containing the byte.</p>
<p>Return which disk sector is storing a particular byte within the file. This is essentially a translation from a virtual address (the offset in the file) to a physical address (the sector where the data at the offset is stored).</p>
<ul>
<li><code>offset</code> is the location within the file of the byte in question. </li>
</ul>

</div>
</div>
<a id="aba5f6b90b6d3e51b293e0bad250699fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba5f6b90b6d3e51b293e0bad250699fc">&#9670;&nbsp;</a></span>Deallocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileHeader::Deallocate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBitmap.html">Bitmap</a> *&#160;</td>
          <td class="paramname"><em>freeMap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>De-allocate this file's data blocks. </p>
<p>De-allocate all the space allocated for data blocks for this file.</p>
<ul>
<li><code>freeMap</code> is the bit map of free disk sectors. </li>
</ul>

</div>
</div>
<a id="a5f204ada637bf3cbd4c7438b7db30fa5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f204ada637bf3cbd4c7438b7db30fa5">&#9670;&nbsp;</a></span>FetchFrom()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileHeader::FetchFrom </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>sector</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize file header from disk. </p>
<p>Fetch contents of file header from disk.</p>
<ul>
<li><code>sector</code> is the disk sector containing the file header. </li>
</ul>

</div>
</div>
<a id="a58fa10ef7ffd228b461ce7519e0e60c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58fa10ef7ffd228b461ce7519e0e60c7">&#9670;&nbsp;</a></span>FileLength()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned FileHeader::FileLength </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the length of the file in bytes. </p>
<p>Return the number of bytes in the file. </p>

</div>
</div>
<a id="a1da76f52a592a1debb38ae0c05d62cf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1da76f52a592a1debb38ae0c05d62cf9">&#9670;&nbsp;</a></span>GetRaw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structRawFileHeader.html">RawFileHeader</a> * FileHeader::GetRaw </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the raw file header structure.</p>
<p>NOTE: this should only be used by routines that operate on the file system at a low level. </p>

</div>
</div>
<a id="a8b7b8f2d9b0ddc2a78b29b0aac89dd49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b7b8f2d9b0ddc2a78b29b0aac89dd49">&#9670;&nbsp;</a></span>Print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileHeader::Print </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>title</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print the contents of the file. </p>
<p>Print the contents of the file header, and the contents of all the data blocks pointed to by the file header. </p>

</div>
</div>
<a id="a0d08a36ec22587dd7219596bed30beb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d08a36ec22587dd7219596bed30beb5">&#9670;&nbsp;</a></span>WriteBack()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileHeader::WriteBack </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>sector</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write modifications to file header back to disk. </p>
<p>Write the modified contents of the file header back to disk.</p>
<ul>
<li><code>sector</code> is the disk sector to contain the file header. </li>
</ul>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ad0a0cd13bb4f917c85d45a446a2e61df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0a0cd13bb4f917c85d45a446a2e61df">&#9670;&nbsp;</a></span>raw</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRawFileHeader.html">RawFileHeader</a> FileHeader::raw</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>code/filesys/<a class="el" href="file__header_8hh_source.html">file_header.hh</a></li>
<li>code/filesys/<a class="el" href="file__header_8cc.html">file_header.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
